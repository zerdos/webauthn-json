{
  "version": 3,
  "sources": ["../../src/webauthn-json/extended/schema.ts", "../../src/dev/inspector/inspector.ts"],
  "sourcesContent": ["import {\n  credentialCreationOptions,\n  credentialRequestOptions,\n  publicKeyCredentialWithAssertion,\n  publicKeyCredentialWithAttestation,\n} from \"../basic/schema\";\nimport { convertValue, copyValue, derived, optional } from \"../convert\";\nimport { Schema } from \"../schema-format\";\n\n// shared\n\nconst authenticationExtensionsClientInputsSchema: Schema = {\n  appid: optional(copyValue),\n  appidExclude: optional(copyValue),\n  uvm: optional(copyValue),\n  credProps: optional(copyValue),\n  largeBlob: optional({\n    support: optional(copyValue),\n    read: optional(copyValue),\n    write: optional(convertValue),\n  }),\n};\n\nconst authenticationExtensionsClientOutputsSchema: Schema = {\n  appid: optional(copyValue),\n  appidExclude: optional(copyValue),\n  uvm: optional(copyValue),\n  credProps: optional(copyValue),\n  largeBlob: optional({\n    supported: optional(copyValue),\n    blob: optional(convertValue),\n    written: optional(copyValue),\n  }),\n};\n\n// create\n\nexport const credentialCreationOptionsExtended: Schema = JSON.parse(\n  JSON.stringify(credentialCreationOptions),\n);\n(credentialCreationOptionsExtended as any).publicKey.schema.extensions =\n  optional(authenticationExtensionsClientInputsSchema);\n\nexport const publicKeyCredentialWithAttestationExtended: Schema = JSON.parse(\n  JSON.stringify(publicKeyCredentialWithAttestation),\n);\n(publicKeyCredentialWithAttestationExtended as any).clientExtensionResults =\n  derived(\n    authenticationExtensionsClientOutputsSchema,\n    (publicKeyCredentialWithAttestation as any).clientExtensionResults.derive,\n  );\n(publicKeyCredentialWithAttestationExtended as any).response.schema.transports =\n  (publicKeyCredentialWithAttestation as any).response.schema.transports;\n// get\n\nexport const credentialRequestOptionsExtended: Schema = JSON.parse(\n  JSON.stringify(credentialRequestOptions),\n);\n(credentialRequestOptionsExtended as any).publicKey.schema.extensions =\n  optional(authenticationExtensionsClientInputsSchema);\n\nexport const publicKeyCredentialWithAssertionExtended: Schema = JSON.parse(\n  JSON.stringify(publicKeyCredentialWithAssertion),\n);\n(publicKeyCredentialWithAssertionExtended as any).clientExtensionResults =\n  derived(\n    authenticationExtensionsClientOutputsSchema,\n    (publicKeyCredentialWithAssertion as any).clientExtensionResults.derive,\n  );\n", "import { bufferToBase64url } from \"../../webauthn-json/base64url\";\nimport {\n  createRequestFromJSON,\n  createResponseToJSON,\n  getRequestFromJSON,\n  getResponseToJSON,\n} from \"../../webauthn-json/basic/api\";\nimport {\n  credentialCreationOptionsExtended,\n  credentialRequestOptionsExtended,\n} from \"../../webauthn-json/extended/schema\";\n\nimport { inspectorCSS } from \"./inspector.css\";\nimport { convert } from \"../../webauthn-json/convert\";\n\nconst originalCreate = navigator.credentials?.create.bind(\n  navigator.credentials,\n);\n\nconst originalGet = navigator.credentials?.get.bind(navigator.credentials);\n\nif (!navigator.credentials) {\n  (navigator as any).credentials = {};\n}\n\nexport class WebAuthnInspector extends HTMLElement {\n  shadow: ShadowRoot;\n  contentWrapper: HTMLDivElement;\n  header: HTMLDivElement;\n  textareaWrapper: HTMLDivElement;\n  textarea: HTMLTextAreaElement;\n  controls: HTMLDivElement;\n  closeButton: HTMLButtonElement;\n  opButton: HTMLButtonElement;\n  close: () => void;\n  constructor() {\n    super();\n    this.shadow = this.attachShadow({ mode: \"closed\" });\n\n    const cssElem: HTMLStyleElement = document.createElement(\"style\");\n    cssElem.textContent = inspectorCSS;\n    this.shadow.appendChild(cssElem);\n\n    this.contentWrapper = document.createElement(\"div\");\n    this.contentWrapper.classList.add(\"wrapper\");\n    this.shadow.appendChild(this.contentWrapper);\n\n    this.header = document.createElement(\"div\");\n    this.header.textContent = \"WebAuthn Request\";\n    this.header.classList.add(\"header\");\n    this.contentWrapper.appendChild(this.header);\n\n    this.controls = document.createElement(\"div\");\n    this.controls.classList.add(\"controls\");\n    this.contentWrapper.appendChild(this.controls);\n\n    this.textareaWrapper = document.createElement(\"div\");\n    this.textareaWrapper.classList.add(\"textarea-wrapper\");\n    this.contentWrapper.appendChild(this.textareaWrapper);\n\n    this.textarea = document.createElement(\"textarea\");\n    this.textareaWrapper.appendChild(this.textarea);\n\n    this.closeButton = document.createElement(\"button\");\n    this.closeButton.textContent = \"Close\";\n    this.closeButton.addEventListener(\"click\", () => {\n      document.body.removeChild(this);\n      if (this.close) {\n        this.close();\n      }\n    });\n    this.controls.appendChild(this.closeButton);\n\n    const copyButton = document.createElement(\"button\");\n    copyButton.textContent = \"Copy JSON\";\n    copyButton.addEventListener(\"click\", () => {\n      navigator.clipboard.writeText(this.textarea.value);\n      copyButton.textContent = \"Copied!\";\n      setTimeout(() => {\n        copyButton.textContent = \"Copy JSON\";\n      }, 1000);\n    });\n    this.controls.appendChild(copyButton);\n\n    document.body.appendChild(this);\n  }\n\n  async create(\n    options?: CredentialCreationOptions,\n  ): Promise<Credential | null> {\n    return new Promise((resolve, reject) => {\n      this.close = () => {\n        reject(\"WebAuthn inspector closed\");\n      };\n      const json = convert(\n        bufferToBase64url,\n        credentialCreationOptionsExtended,\n        options,\n      );\n      this.header.textContent = \"WebAuthn Create Request\";\n      this.textarea.value = JSON.stringify(json, null, \"  \");\n      this.opButton = document.createElement(\"button\");\n      this.opButton.textContent = \"Create\";\n      this.opButton.addEventListener(\"click\", async () => {\n        try {\n          const requestJSON = JSON.parse(this.textarea.value!);\n          const request = createRequestFromJSON(requestJSON);\n          const response = await originalCreate(request);\n          this.success(\"Create\", createResponseToJSON(response));\n          this.closeButton.textContent = \"Respond\";\n          this.close = () => {\n            resolve(response);\n          };\n        } catch (e) {\n          this.failure(\"Create\", e);\n          this.close = () => {\n            reject(e);\n          };\n        }\n      });\n      this.controls.appendChild(this.opButton);\n    });\n  }\n\n  async get(options?: CredentialCreationOptions): Promise<Credential | null> {\n    return new Promise((resolve, reject) => {\n      this.close = () => {\n        reject(\"WebAuthn inspector closed\");\n      };\n      const json = convert(\n        bufferToBase64url,\n        credentialRequestOptionsExtended,\n        options,\n      );\n      this.header.textContent = \"WebAuthn Get Request\";\n      this.textarea.value = JSON.stringify(json, null, \"  \");\n      this.opButton = document.createElement(\"button\");\n      this.opButton.textContent = \"Get\";\n      this.opButton.addEventListener(\"click\", async () => {\n        try {\n          const requestJSON = JSON.parse(this.textarea.value!);\n          const request = getRequestFromJSON(requestJSON);\n          console.log(request);\n          const response = await originalGet(request);\n          this.success(\"Get\", getResponseToJSON(response));\n          this.closeButton.textContent = \"Respond\";\n          this.close = () => {\n            resolve(response);\n          };\n        } catch (e) {\n          this.failure(\"Get\", e);\n          this.close = () => {\n            reject(e);\n          };\n        }\n      });\n      this.controls.appendChild(this.opButton);\n    });\n  }\n\n  success(op: string, responseJSON: any): void {\n    this.controls.removeChild(this.opButton);\n    this.header.textContent = `\u2705 WebAuthn ${op} Response`;\n    this.contentWrapper.classList.add(\"success\");\n    this.textarea.value = JSON.stringify(responseJSON, null, \"  \");\n  }\n\n  failure(op: string, e: Error): void {\n    this.controls.removeChild(this.opButton);\n    this.header.textContent = `\u274C WebAuthn ${op} Response`;\n    this.contentWrapper.classList.add(\"failure\");\n    this.textarea.value = e.toString();\n  }\n}\n\ncustomElements.define(\"webauthn-inspector\", WebAuthnInspector);\n\nnavigator.credentials.create = async function (\n  options?: CredentialCreationOptions,\n): Promise<Credential | null> {\n  console.log(options);\n  const interceptor = new WebAuthnInspector();\n  return await interceptor.create(options);\n};\n\nnavigator.credentials.get = async function (\n  options?: CredentialCreationOptions,\n): Promise<Credential | null> {\n  const interceptor = new WebAuthnInspector();\n  return await interceptor.get(options);\n};\n\nconsole.log(\"WebAuthn Inspector is active!\");\n"],
  "mappings": "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",
  "names": []
}
